<!doctype html>
<html>

	<head>
		<meta charset="utf-8"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
		<meta name="viewport" content="width=device-width, initial-scale=1"/>

		<title>Ccall : 1-Click Conference Calls</title>

		<link rel="stylesheet" type="text/css" href="css/style.css"/>
		<script type="text/javascript" src="//use.typekit.net/rrf5isi.js"></script>
		<script type="text/javascript">
			try {
				Typekit.load();
			} catch(e) {
			}
		</script>
		<script type="text/javascript" src="js/service/Service.js"></script>
		<script type="text/javascript" src="js/vo/ShortURL.js"></script>
	</head>

	<body lang="en">

		<div id="container">

			<div id="main">

				<div id="cc-logo" class="logo" alt="ccall">
					c
				</div>
				<h1>Conference calls
				<br>
				without ass pain.
				<br>
				</h1>
				<p>
					<form id="confForm" name="confForm" action="javascript:validateForm();">
						<div class="step">
							We’ll combine the # and code into a single link for <b>iPhone*</b> users.
						</div>
						<input type="tel" id="confNumber" placeholder="phone #">
						<input type="tel" id="confID" placeholder="conf code #">
						<br>
						<br>
						<button type="submit" id="submitButton" class="inactive">
							GET MAGIC LINK
						</button>

					</form>
					<div id="link-holder"></div>
				</p>
				<article>
					<b>We made CCALL because</b> it’s a pain in the ass to enter conference codes from a mobile phone. If you've ever had a calendar invite with a long conference ID and scribbled it on the back of your hand to avoid jumping between the email, your calendar and your phone app then you understand why we did this.
					<br>
					<br>
					<div class="logo" id="experiment-logo">
						<a href="mailto:nickvelloff@theexperiment.io"><img src="img/logo_exp.svg"></a>
					</div>
					is a design and technology collective built to solve modern problems.
					<br>
					<br>
					*Android still pain in ass.
				</article>

			</div>

		</div><!-- main -->

		<div></div><!-- container -->

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
		<script>
			window.jQuery || document.write('<script src="js/libs/jquery-1.11.1.min.js"><\/script>');
		</script>
		<script src="js/plugins.js"></script>
		<script src="js/script.js"></script>
		<script src="js/libs/jquery.urlshortener.min.js"></script>
		<script src="js/libs/detectmobilebrowser.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/zeroclipboard/2.1.5/ZeroClipboard.min.js"></script>

		<script>
			(function(i, s, o, g, r, a, m) {
				i['GoogleAnalyticsObject'] = r;
				i[r] = i[r] ||
				function() {
					(i[r].q = i[r].q || []).push(arguments);
				}, i[r].l = 1 * new Date();
				a = s.createElement(o), m = s.getElementsByTagName(o)[0];
				a.async = 1;
				a.src = g;
				m.parentNode.insertBefore(a, m);
			})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

			ga('create', 'UA-45973655-2', 'ccall.me');
			ga('send', 'pageview');
		</script>

		<script type="text/javascript">
		
			var cn = $("#confNumber");
			var cid = $("#confID");
			cn.bind('keyup', keyHandler);
			cid.bind('keyup', keyHandler);
			
			function keyHandler(argument) {
				if (cn.val().length >= 1 && cid.val().length >= 1) {
					$('#link-holder').empty();
					$('#submitButton').removeClass('inactive');
				} else {
					$('#submitButton').addClass('inactive');
				}
			}

			var service = Service.getInstance();
			var scope = this;
			var client;
			var cbInit = false;
			var longURL;

			/*
			 * Listener for the service
			 */
			$(service).on("shortURLDataSuccess", function(event, response) {
				console.log(response.data);
				//_trackEvent(category, action, opt_label, opt_value, opt_noninteraction)
				// scope.ga.push(['_trackEvent', 'Url', 'Reveived', response.data]);
				if (!$.browser.mobile) {
					$('#link-holder').html('<div class="step" id="step3">Click this magic link so iPhoners can avoid pain.</div><button type="submit" id="submitButton" class="clip_button">' + response.data.url + ' - Click To Copy</button>');
					if (!cbInit)
						initClipboard(response.data.url);
				} else {
					$('#link-holder').html('<div class="step" id="step3">Copy/paste this magic link so iPhoners can avoid pain.</div><h2><a href="' + response.data.url + '">' + response.data.url + '</a></h2>');
				}
			});

			function initClipboard(url) {
				client = new ZeroClipboard($('.clip_button'));
				client.on('ready', function(event) {
					// console.log('movie is loaded');
					client.on('copy', function(event) {
						event.clipboardData.setData('text/plain', url);
					});
					client.on('aftercopy', function(event) {
						// console.log('Copied text to clipboard: ' + event.data['text/plain']);
						$('#link-holder').html('<div class="step" id="step3">Your magic link has been copied to your clipboard. Now just Ctrl/V or Command/V(mac)</div>');
						resetForm();
					});
				});

				client.on('error', function(event) {
					console.log('ZeroClipboard error of type "' + event.name + '": ' + event.message);
					$('#link-holder').html('<div class="step" id="step3">Opps, something happened getting your magic link. Please try again.</div>');
				});
				cbInit = true;

			}

			function resetForm() {
				confForm.confID.value = '';
				confForm.confNumber.value = '';
				$('#submitButton').addClass('inactive');
				ZeroClipboard.destroy();
				cbInit = false;
			}

			function validateForm() {
				// check for valid numbers
				var error;
				var cn = confForm.confNumber.value.replace(/\D/g, '');
				var cd = confForm.confID.value;

				if (cn.length != 7 && cn.length != 10 && cn.length != 11) {// ADD REGEX HERE
					confForm.confNumber.className = 'error';
					error = true;
				}
				if (cd.length <= 1) {
					confForm.confID.className = 'error';
					error = true;
				}

				if (error) {
					setTimeout(function() {
						confForm.confID.className = '';
						confForm.confNumber.className = '';
					}, 2000);
					return;
				}
				// check for missing #
				if (cd.charAt(cd.length - 1) != '#') {
					var r = confirm("Cancel if you need to add a # to the end of your code.");
					if (r == true) {
						setLongURL();
					}

				} else {
					setLongURL();
				}
			}

			function setLongURL() {

				var httpBase = $(location).attr('href').substring(0, $(location).attr('href').lastIndexOf("/") + 1);

				// strip off # if one exists
				var localConfId = confForm.confID.value;
				var lastChar = localConfId.substr(confForm.confID.value.length - 1);
				var useHash = lastChar == '#';

				// strip off all non-numerical characters from phone number
				var localConfPhoneNumber = confForm.confNumber.value;
				localConfPhoneNumber = localConfPhoneNumber.replace(/\D/g, '');

				if (useHash)// strip it off
				{
					localConfId = localConfId.substring(0, localConfId.length - 1);
				}
				longURL = httpBase + 'ccall_result.html?n=' + localConfPhoneNumber + '&i=' + localConfId + ((useHash) ? ('&useHash=true') : ('&useHash=false'));

				service.getShortURL(longURL);
			}


			$('#cc-logo').click(function() {
				var httpBase = $(location).attr('href').substring(0, $(location).attr('href').lastIndexOf("/") + 1);
				window.location = httpBase;
			});
			$('#cc-logo').hover(function() {
				$(this).css('cursor', 'pointer');
			});

		</script>

	</body>

</html>